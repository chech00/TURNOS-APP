ANTIGRAVITY — ESPECIFICACIÓN DE DEPENDENCIAS / IMPACTO (KML)

OBJETIVO
Calcular, para cada falla:
  1) Corte de fibra en un ENLACE (LineString / edge)
  2) Caída de un NODO (Point / node)
y devolver qué nodos quedan sin conectividad hacia el core.

DEFINICIONES
- ROOTS (core): Nodo Data Center PM, Nodo Data Center PV
- Grafo: no dirigido (undirected)
- Nodo afectado: nodo que estaba 'reachable' en el estado base y pasa a 'unreachable' tras la falla.
  (O sea: affected = reachable_base - reachable_after)

EXTRACCIÓN DESDE KML
- Cada Placemark con <Point> es un NODE.
- Cada Placemark con <LineString> es un EDGE.
- ID de nodo: usar el <name> del Point.
- ID de enlace: usar el <name> del LineString; si hay nombres repetidos, numerar como: "NOMBRE#2", "NOMBRE#3", ...

SNAPPING (conexión de extremos de una línea a nodos)
- Para cada LineString, tomar su primer y último vértice (coord inicio y fin).
- Buscar el Point más cercano a cada extremo:
  - si distancia <= 50 m => match_quality="exact"
  - si distancia > 50 m pero <= 700 m => match_quality="fuzzy" (aceptar, pero reportar)
  - si distancia > 700 m => crear nodo intermedio EMPALME_edgeid_A/B (solo si se quiere forzar topología)
NOTA: Este KML tiene algunos extremos que no caen exactamente sobre un Point; por eso existe el modo "fuzzy".

CÁLCULO BASE
1) Calcular reachable_base: hacer BFS/DFS desde ambos ROOTS sobre el grafo completo.
2) Un nodo que NO esté en reachable_base (por ejemplo, un componente RF aislado) NO debe aparecer como afectado por fallas.

IMPACTO POR CORTE DE ENLACE (por edge)
Para cada edge_id:
- Remover ese enlace del grafo (solo ese enlace).
- Calcular reachable_after (BFS desde ROOTS).
- affected_nodes = reachable_base - reachable_after
- Salida: edge_id -> lista de affected_nodes (ordenada alfabéticamente)

IMPACTO POR CAÍDA DE NODO (por node)
Para cada node_id:
- Remover ese nodo y todos sus enlaces incidentes.
- Calcular reachable_after (BFS desde ROOTS).
- affected_nodes = (reachable_base - reachable_after) U {node_id} si node_id estaba en reachable_base.
- Salida: node_id -> lista de affected_nodes (ordenada alfabéticamente)

REPORTES DE CONSISTENCIA (muy importante para uptime)
- nodos aislados (grado 0)
- componentes desconectados del core (no alcanzables desde ROOTS)
- enlaces con match_quality="fuzzy" (extremos >50m)

ARCHIVOS ADJUNTOS
- topologia_normalizada_antigravity.kml : mismo KML pero con ExtendedData que ya incluye:
    node_id, edge_id, from_node, to_node, distancias y roots.
- impacto_dependencias_kml.json : grafo + impact_by_edge + impact_by_node ya calculados con la regla anterior.