<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Turnos Noc - Calendario de Turnos</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="./css/styles.css">
  <link rel="stylesheet" href="./css/noc.css" />
</head>

<body>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <img src="https://i.ibb.co/HqrX2cr/LOGO-COLOR-2-SLOGAN-768x185.png" alt="Logo de la Empresa" class="logo-sidebar">
    </div>
    <nav class="sidebar-menu">
      <ul>
        <li><a href="index.html" id="menu-turnos"><i data-lucide="calendar"></i> <span>Turnos</span></a></li>
        <li><a href="senales.html" id="menu-fibra"><i data-lucide="waypoints"></i> <span>Señal de Fibra</span></a></li>
        <li><a href="documentos.html" id="menu-doc"><i data-lucide="dock"></i> <span>Documentos Noc</span></a></li>
        <li><a href="noc.html" id="calendar-check" class="active"><i data-lucide="calendar-check"></i> <span>Turnos
              Noc</span></a></li>
        <li id="li-empleados" class="admin-only">
          <a href="gestion_empleados.html">
            <i data-lucide="users"></i>
            <span>Gestionar Empleados</span>
          </a>
        </li>
        <li id="li-registros" style="display:none;">
          <a href="registros.html">
            <i data-lucide="file-text"></i>
            <span>Registros</span>
          </a>
        </li>
      </ul>
    </nav>
    <button id="logout-btn" class="primary-btn logout-btn">
      <i data-lucide="log-out"></i> <span>Cerrar sesión</span>
    </button>
  </div>

  <!-- Contenedor Principal -->
  <div id="main-content" class="main-content">
    <header>
      <div class="container header-container">
        <button id="menu-toggle" class="menu-btn">
          <i data-lucide="panel-left"></i>
        </button>
        <h1>Turnos Noc</h1>


      </div>
    </header>

    <main>
      <div class="container">

        <!-- Sección Calendario General con encabezado personalizado -->
        <section id="general-calendar-container" class="calendar-container">
          <div class="calendar-header">
            <div class="month-navigator">
              <button id="prev-month" class="btn-icon">
                <i data-lucide="chevron-left"></i>
              </button>
              <span id="current-month" class="text-xl">Mes y Año</span>
              <button id="next-month" class="btn-icon">
                <i data-lucide="chevron-right"></i>
              </button>
              <button id="today" class="btn-icon">
                <i data-lucide="calendar-day"></i> Hoy
              </button>
            </div>
          </div>
          <table id="general-calendar" class="calendar">
            <thead>
              <tr>
                <th class="text-left">Empleado</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </section>

        <!-- Calendario Nocturno -->
        <section id="nocturno-calendar-container" class="calendar-container">
          <h2>Calendario Nocturno - Cristian Oyarzo</h2>
          <table id="nocturno-calendar" class="calendar">
            <thead>
              <tr>
                <th class="text-left">Empleado</th>
              </tr>

            </thead>
            <tbody id="calendario-nocturno">
            </tbody>
          </table>
        </section>

        <!-- Calendario Feriados/Fines de Semana -->
        <section id="feriados-calendar-container" class="calendar-container">
          <h2>Calendario Feriados/Fines de Semana - Turno Especial</h2>
          <table id="feriados-calendar" class="calendar">
            <thead>
              <tr>
                <th class="text-left">Empleado</th>
              </tr>
            </thead>
            <tbody id="calendario-feriados">
            </tbody>
          </table>

          <!-- Tabla de Horas Extras (Diseño de Tarjetas) -->
          <div class="horas-extras-wrapper admin-only" style="margin-top: 2rem;">
            <h3
              style="margin-bottom: 1rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
              <i data-lucide="clock" style="color: var(--accent-color);"></i>
              Control de Horas Extras <span style="font-size: 0.9rem; opacity: 0.7; font-weight: normal;">(26 mes
                anterior - 25 mes actual)</span>
            </h3>

            <div class="overtime-cards-container">
              <!-- Card Sergio -->
              <div class="overtime-card">
                <div class="card-icon-wrapper" style="background: rgba(74, 144, 226, 0.2); color: #4A90E2;">
                  <i data-lucide="user"></i>
                </div>
                <div class="card-content">
                  <h4>Sergio Castillo</h4>
                  <div class="card-stats">
                    <div class="stat-box">
                      <span class="stat-label">Turnos</span>
                      <span class="stat-value" id="count-sergio">0</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-box">
                      <span class="stat-label">Horas Totales</span>
                      <span class="stat-value highlight" id="hours-sergio">0</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Card Ignacio -->
              <div class="overtime-card">
                <div class="card-icon-wrapper" style="background: rgba(44, 62, 80, 0.2); color: #aab7c4;">
                  <i data-lucide="user"></i>
                </div>
                <div class="card-content">
                  <h4>Ignacio Aburto</h4>
                  <div class="card-stats">
                    <div class="stat-box">
                      <span class="stat-label">Turnos</span>
                      <span class="stat-value" id="count-ignacio">0</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-box">
                      <span class="stat-label">Horas Totales</span>
                      <span class="stat-value highlight" id="hours-ignacio">0</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Sección Turnos y Backup -->
        <section class="turnos-backup">
          <div class="turnos-section admin-only">
            <h2>Turnos</h2>

            <div class="assignment-container">
              <div class="turnos-buttons">
                <!-- Fila 1 -->
                <button data-turno="M0" class="btn-turno" data-color="#648c9b"
                  style="background-color: #648c9b;">M0</button>
                <button data-turno="M0A" class="btn-turno" data-color="#7b69a5"
                  style="background-color: #7b69a5;">M0A</button>
                <button data-turno="M1" class="btn-turno" data-color="#557a5f"
                  style="background-color: #557a5f;">M1</button>
                <button data-turno="M1A" class="btn-turno" data-color="#c49f87"
                  style="background-color: #c49f87;">M1A</button>
                <button data-turno="M1B" class="btn-turno" data-color="#ffaaa5"
                  style="background-color: #ffaaa5;">M1B</button>
                <button data-turno="M2" class="btn-turno" data-color="#ffcc99"
                  style="background-color: #ffcc99;">M2</button>
                <button data-turno="M2A" class="btn-turno" data-color="#d4a5a5"
                  style="background-color: #d4a5a5;">M2A</button>

                <!-- Fila 2 -->
                <button data-turno="M2B" class="btn-turno" data-color="#b5e7a0"
                  style="background-color: #b5e7a0;">M2B</button>
                <button data-turno="M3" class="btn-turno" data-color="#996a7f"
                  style="background-color: #996a7f;">M3</button>
                <button data-turno="V" class="btn-turno" data-color="#88C0A6"
                  style="background-color: #88C0A6;">V</button>
                <button data-turno="L" class="btn-turno" data-color="#8FBCBB"
                  style="background-color: #8FBCBB;">L</button>
                <button data-turno="DL" class="btn-turno" data-color="#D77A7A"
                  style="background-color: #D77A7A;">DL</button>
                <button data-turno="N" class="btn-turno" data-color="#cccccc"
                  style="background-color: #cccccc;">N</button>
                <button data-turno="S" class="btn-turno" data-color="#4A90E2"
                  style="background-color: #4A90E2;">S</button>

                <!-- Fila 3 -->
                <button data-turno="I" class="btn-turno" data-color="#2C3E50"
                  style="background-color: #2C3E50;">I</button>
              </div>
            </div>
          </div>

          <div class="backup-container">
            <h2>Backup</h2>

            <!-- Dropdown visible para todos -->
            <div class="dropdown-container">
              <select id="mesesGuardados" class="select-meses">
                <option value="">-- Seleccione un mes guardado --</option>
              </select>
            </div>

            <div class="backup-controls">
              <!-- Botones visibles para todos -->
              <button id="btnCargar" class="btn-cargar"><i data-lucide="upload"></i> Cargar Calendario</button>
              <button id="btnVerHorarios" class="btn-horarios"><i data-lucide="clock"></i> Ver Horarios de
                Turnos</button>

              <!-- Botones solo para admin/superadmin -->
              <button id="btnGuardar" class="btn-guardar admin-only"><i data-lucide="save"></i> Guardar
                Calendario</button>
              <button id="btnEliminar" class="btn-cargar admin-only" style="background-color: #d77a7a;"><i
                  data-lucide="trash-2"></i> Eliminar</button>
              <button id="btnVerEstadisticas" class="btn-horarios admin-only"><i data-lucide="bar-chart-3"></i> Ver
                Estadísticas</button>
              <button id="btnVerSugerencias" class="btn-horarios admin-only"><i data-lucide="lightbulb"></i> Ver
                Sugerencias</button>
              <button id="btnAutoAsignar" class="btn-cargar admin-only" style="background-color: #7796cb;">
                <i data-lucide="wand-2"></i> Auto-Asignar Turnos
              </button>

              <!-- Modal para Sugerencias -->
              <div id="modalSugerencias" class="modal-horarios">
                <div class="modal-horarios-content">
                  <span id="cerrarSugerencias" class="close-horarios">&times;</span>
                  <h2>Sugerencias de Optimización</h2>
                  <ul id="listaSugerencias"></ul>
                </div>
              </div>

              <!-- Modal para Estadísticas Mejoradas -->
              <div id="modalEstadisticas" class="modal-horarios">
                <div class="modal-horarios-content">
                  <span id="cerrarEstadisticas" class="close-horarios">&times;</span>
                  <h2>Turnos - Estadísticas</h2>

                  <!-- Tarjetas de Métricas -->
                  <div class="stats-cards">
                    <div class="stats-card">
                      <h3>Total Turnos</h3>
                      <p id="total-turnos">0</p>
                    </div>
                    <div class="stats-card">
                      <h3>Turno más usado</h3>
                      <p id="turno-mas-usado">-</p>
                    </div>
                    <div class="stats-card">
                      <h3>Turno menos usado</h3>
                      <p id="turno-menos-usado">-</p>
                    </div>
                  </div>

                  <!-- Tabla de Turnos por Empleado -->
                  <h3>Distribución de Turnos por Empleado</h3>
                  <table class="tabla-turnos-empleados">
                    <thead>
                      <tr>
                        <th>Empleado</th>
                        <th>Turno más asignado</th>
                        <th>Turno menos asignado</th>
                      </tr>
                    </thead>
                    <tbody id="tabla-turnos-empleados">
                      <!-- Se llenará dinámicamente con JS -->
                    </tbody>
                  </table>

                  <!-- Contenedor de Gráficos -->
                  <div class="charts-container">
                    <h3>Distribución de Turnos</h3>
                    <canvas id="graficoTurnos"></canvas>

                    <h3>Carga de Trabajo por Empleado</h3>
                    <canvas id="graficoEmpleados"></canvas>

                    <h3>Tendencias de Asignación de Turnos</h3>
                    <canvas id="graficoTendencias"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Sección Empleados -->
        <section class="employees">
          <h2>Equipo Noc</h2>
          <div class="employee-cards">
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Sergio Castillo" class="employee-photo" />
              <h3 class="employee-name">Sergio Castillo</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Ignacio Aburto" class="employee-photo" />
              <h3 class="employee-name">Ignacio Aburto</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Claudio Bustamante" class="employee-photo" />
              <h3 class="employee-name">Claudio Bustamante</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Julio Oliva" class="employee-photo" />
              <h3 class="employee-name">Julio Oliva</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Gabriel Trujillo" class="employee-photo" />
              <h3 class="employee-name">Gabriel Trujillo</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
            <div class="employee-card">
              <img src="https://via.placeholder.com/120" alt="Cristian Oyarzo" class="employee-photo" />
              <h3 class="employee-name">Cristian Oyarzo</h3>
              <p class="employee-role">Operador NOC</p>
              <input type="file" accept="image/*" class="photo-input" style="display: none;">
              <button class="upload-photo-btn admin-only"><i data-lucide="camera"></i> Cambiar foto</button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <p>PatagoniaIP SPA - Todos los derechos reservados</p>
    </footer>
  </div>

  <!-- Modal Calendario Guardado -->
  <div id="modalCalendario" class="modal">
    <div class="modal-content">
      <span id="cerrarModal" class="close">&times;</span>
      <h2>Calendario Guardado</h2>
      <div id="contenidoModal"></div>
    </div>
  </div>

  <!-- Modal Horarios -->
  <div id="modalHorarios" class="modal-horarios">
    <div class="modal-horarios-content">
      <span id="cerrarHorarios" class="close-horarios">&times;</span>
      <h2>Horarios de Turnos</h2>
      <table class="tabla-horarios">
        <thead>
          <tr>
            <th>Turnos</th>
            <th>Horarios</th>
            <th>Días Libres</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>M0</td>
            <td>09:00hrs - 19:00hrs</td>
            <td>Martes, Jueves</td>
          </tr>
          <tr>
            <td>M0A</td>
            <td>09:00hrs - 19:00hrs</td>
            <td>Miércoles, Domingo</td>
          </tr>
          <tr>
            <td>M1</td>
            <td>08:30hrs - 17:30hrs<br>Sábado 8:30hrs - 13:30hrs</td>
            <td>Domingo</td>
          </tr>
          <tr>
            <td>M1A</td>
            <td>08:30hrs - 18:30hrs</td>
            <td>Sábado, Domingo</td>
          </tr>
          <tr>
            <td>M1B</td>
            <td>7:00hrs - 17:00hrs</td>
            <td>Sábado, Domingo</td>
          </tr>
          <tr>
            <td>M2</td>
            <td>11:00hrs - 20:00hrs<br>Sábado 13:00hrs - 18:00hrs</td>
            <td>Domingo</td>
          </tr>
          <tr>
            <td>M2A</td>
            <td>10:00hrs - 20:00hrs</td>
            <td>Sábado, Domingo</td>
          </tr>
          <tr>
            <td>M2B</td>
            <td>10:00hrs - 20:00hrs</td>
            <td>Miércoles, Domingo</td>
          </tr>
          <tr>
            <td>M3</td>
            <td>11:00hrs - 21:00hrs</td>
            <td>Martes, Jueves</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal para Estadísticas (simple, se mantiene para compatibilidad si lo usabas) -->
  <div id="modalEstadisticasSimple" class="modal-horarios" style="display:none;">
    <div class="modal-horarios-content">
      <span class="close-horarios">&times;</span>
      <h2>Estadísticas</h2>
      <div id="estadisticas-contenido"></div>
    </div>
  </div>

  <script type="module" src="./js/firebase.js"></script>
  <script type="module" src="./js/noc.js"></script>
  <script>
    lucide.createIcons();
  </script>
</body>

</html>